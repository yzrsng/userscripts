// ==UserScript==
// @name Dynamic Restyle Script for Global Black
// @namespace drs4gb
// @author yzrsng
// @description Userscript to change color on website. The performance of this script is very low.
// @version 0.20191006.1
// @include http://*
// @include https://*
// @exclude https://www.deviantart.com/*
// @exclude https://twitter.com/*
// @exclude https://mobile.twitter.com/*
// @exclude https://store.steampowered.com/*
// @grant none
// ==/UserScript==

/*
圧縮版。

ウェブページの要素の増減を検知して動的に色を変更する。
パフォーマンスが悪い。
ウェブページの変化を確認する間隔はsetTimeoutで指定。標準は1.0秒。

色はRGBからHSVに変換していじっている。背景色の明るさは鮮やかさに比例するようにした。
画像の上の文字が色の変更で判別できなくなると困るので黒い縁取り文字にした。
背景色の変化で画像が判別できなくなると困るので後光が指すようにした。
*/

var $jscomp$templatelit$0=["\n:root {\n  background-color: black;\n}\n* {\n  scrollbar-color: #2a2c2e #1c1e1f;\n}\n::-webkit-scrollbar {\n  background-color: #1c1e1f;\n  color: #c5c1b9;\n}\n::-webkit-scrollbar-corner {\n  background-color: #181a1b;\n}\n::-webkit-scrollbar-thumb {\n  background-color: #2a2c2e;\n}\n[","], [","]::placeholder {\n  color: var(",") !important;\n}\n[","]:visited, [","]:visited * {\n  color: var(",") !important;\n}\n[","] {\n  background-color: var(",") !important;\n}\n[",
"] {\n  background-image: var(",") !important;\n}\n[","], [","] * {\n  text-shadow: "," -1px 1px 0px, "," 0px 1px 0px,  "," 1px 1px 0px, "," -1px 0px 0px, "," 1px 0px 0px, "," -1px -1px 0px, "," 0px -1px 0px, "," 1px -1px 0px !important;\n}\n[","] {\n  background-color: rgba(0, 0, 0, 0) !important;\n  filter: var(",") drop-shadow(0px 0px 1px var(",")) !important;\n}"];$jscomp$templatelit$0.raw=$jscomp$templatelit$0.slice();var $jscomp=$jscomp||{};$jscomp.scope={};
$jscomp.arrayIteratorImpl=function(l){var m=0;return function(){return m<l.length?{done:!1,value:l[m++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var m="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return m?m.call(l):$jscomp.arrayIterator(l)};$jscomp.arrayFromIterator=function(l){for(var m,n=[];!(m=l.next()).done;)n.push(m.value);return n};
$jscomp.arrayFromIterable=function(l){return l instanceof Array?l:$jscomp.arrayFromIterator($jscomp.makeIterator(l))};
(function(){function l(a){var c=window.getComputedStyle(a.parentNode).getPropertyValue("background-color");return"rgba(0, 0, 0, 0)"===c?"HTML"===a.parentNode.tagName?"rgb(255, 255, 255)":l(a.parentNode):c}function m(a){for(var c=0;c<a.length;c++)a[c].setAttribute("data-userscript-drs4gb-math",""),m(a[c].children)}var n=document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.id="userscript-drs4gb";p.insertAdjacentHTML("beforeend",String.raw($jscomp$templatelit$0,
"data-userscript-drs4gb-origin-fcolor","data-userscript-drs4gb-origin-fcolor","--userscript-drs4gb-fcolor","data-userscript-drs4gb-enable-fcolor-visited","data-userscript-drs4gb-enable-fcolor-visited","--userscript-drs4gb-fcolor-visited","data-userscript-drs4gb-origin-bgcolor","--userscript-drs4gb-bgcolor","data-userscript-drs4gb-origin-bgimage","--userscript-drs4gb-bgimage","data-userscript-drs4gb-enable-textshadow","data-userscript-drs4gb-enable-textshadow","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)",
"rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","data-userscript-drs4gb-origin-filters","--userscript-drs4gb-origin-filters","--userscript-drs4gb-filter-color"));var y=[["black","rgb(0, 0, 0)"],["silver","rgb(192, 192, 192)"],["gray","rgb(128, 128, 128)"],["white","rgb(255, 255, 255)"],["maroon","rgb(128, 0, 0)"],["red","rgb(255, 0, 0)"],["purple","rgb(128, 0, 128)"],["fuchsia","rgb(255, 0, 255)"],["green","rgb(0, 128, 0)"],
["lime","rgb(0, 255, 0)"],["olive","rgb(128, 128, 0)"],["yellow","rgb(255, 255, 0)"],["navy","rgb(0, 0, 128)"],["blue","rgb(0, 0, 255)"],["teal","rgb(0, 128, 128)"],["aqua","rgb(0, 255, 255)"],["orange","rgb(255, 165, 0)"],["aliceblue","rgb(240, 248, 255)"],["antiquewhite","rgb(250, 235, 215)"],["aquamarine","rgb(127, 255, 212)"],["azure","rgb(240, 255, 255)"],["beige","rgb(245, 245, 220)"],["bisque","rgb(255, 228, 196)"],["blanchedalmond","rgb(255, 235, 205)"],["blueviolet","rgb(138, 43, 226)"],
["brown","rgb(165, 42, 42)"],["burlywood","rgb(222, 184, 135)"],["cadetblue","rgb(95, 158, 160)"],["chartreuse","rgb(127, 255, 0)"],["chocolate","rgb(210, 105, 30)"],["coral","rgb(255, 127, 80)"],["cornflowerblue","rgb(100, 149, 237)"],["cornsilk","rgb(255, 248, 220)"],["crimson","rgb(220, 20, 60)"],["cyan","rgb(0, 255, 255)"],["darkblue","rgb(0, 0, 139)"],["darkcyan","rgb(0, 139, 139)"],["darkgoldenrod","rgb(184, 134, 11)"],["darkgray","rgb(169, 169, 169)"],["darkgreen","rgb(0, 100, 0)"],["darkgrey",
"rgb(169, 169, 169)"],["darkkhaki","rgb(189, 183, 107)"],["darkmagenta","rgb(139, 0, 139)"],["darkolivegreen","rgb(85, 107, 47)"],["darkorange","rgb(255, 140, 0)"],["darkorchid","rgb(153, 50, 204)"],["darkred","rgb(139, 0, 0)"],["darksalmon","rgb(233, 150, 122)"],["darkseagreen","rgb(143, 188, 143)"],["darkslateblue","rgb(72, 61, 139)"],["darkslategray","rgb(47, 79, 79)"],["darkslategrey","rgb(47, 79, 79)"],["darkturquoise","rgb(0, 206, 209)"],["darkviolet","rgb(148, 0, 211)"],["deeppink","rgb(255, 20, 147)"],
["deepskyblue","rgb(0, 191, 255)"],["dimgray","rgb(105, 105, 105)"],["dimgrey","rgb(105, 105, 105)"],["dodgerblue","rgb(30, 144, 255)"],["firebrick","rgb(178, 34, 34)"],["floralwhite","rgb(255, 250, 240)"],["forestgreen","rgb(34, 139, 34)"],["gainsboro","rgb(220, 220, 220)"],["ghostwhite","rgb(248, 248, 255)"],["gold","rgb(255, 215, 0)"],["goldenrod","rgb(218, 165, 32)"],["greenyellow","rgb(173, 255, 47)"],["grey","rgb(128, 128, 128)"],["honeydew","rgb(240, 255, 240)"],["hotpink","rgb(255, 105, 180)"],
["indianred","rgb(205, 92, 92)"],["indigo","rgb(75, 0, 130)"],["ivory","rgb(255, 255, 240)"],["khaki","rgb(240, 230, 140)"],["lavender","rgb(230, 230, 250)"],["lavenderblush","rgb(255, 240, 245)"],["lawngreen","rgb(124, 252, 0)"],["lemonchiffon","rgb(255, 250, 205)"],["lightblue","rgb(173, 216, 230)"],["lightcoral","rgb(240, 128, 128)"],["lightcyan","rgb(224, 255, 255)"],["lightgoldenrodyellow","rgb(250, 250, 210)"],["lightgray","rgb(211, 211, 211)"],["lightgreen","rgb(144, 238, 144)"],["lightgrey",
"rgb(211, 211, 211)"],["lightpink","rgb(255, 182, 193)"],["lightsalmon","rgb(255, 160, 122)"],["lightseagreen","rgb(32, 178, 170)"],["lightskyblue","rgb(135, 206, 250)"],["lightslategray","rgb(119, 136, 153)"],["lightslategrey","rgb(119, 136, 153)"],["lightsteelblue","rgb(176, 196, 222)"],["lightyellow","rgb(255, 255, 224)"],["limegreen","rgb(50, 205, 50)"],["linen","rgb(250, 240, 230)"],["magenta","rgb(255, 0, 255)"],["mediumaquamarine","rgb(102, 205, 170)"],["mediumblue","rgb(0, 0, 205)"],["mediumorchid",
"rgb(186, 85, 211)"],["mediumpurple","rgb(147, 112, 219)"],["mediumseagreen","rgb(60, 179, 113)"],["mediumslateblue","rgb(123, 104, 238)"],["mediumspringgreen","rgb(0, 250, 154)"],["mediumturquoise","rgb(72, 209, 204)"],["mediumvioletred","rgb(199, 21, 133)"],["midnightblue","rgb(25, 25, 112)"],["mintcream","rgb(245, 255, 250)"],["mistyrose","rgb(255, 228, 225)"],["moccasin","rgb(255, 228, 181)"],["navajowhite","rgb(255, 222, 173)"],["oldlace","rgb(253, 245, 230)"],["olivedrab","rgb(107, 142, 35)"],
["orangered","rgb(255, 69, 0)"],["orchid","rgb(218, 112, 214)"],["palegoldenrod","rgb(238, 232, 170)"],["palegreen","rgb(152, 251, 152)"],["paleturquoise","rgb(175, 238, 238)"],["palevioletred","rgb(219, 112, 147)"],["papayawhip","rgb(255, 239, 213)"],["peachpuff","rgb(255, 218, 185)"],["peru","rgb(205, 133, 63)"],["pink","rgb(255, 192, 203)"],["plum","rgb(221, 160, 221)"],["powderblue","rgb(176, 224, 230)"],["rosybrown","rgb(188, 143, 143)"],["royalblue","rgb(65, 105, 225)"],["saddlebrown","rgb(139, 69, 19)"],
["salmon","rgb(250, 128, 114)"],["sandybrown","rgb(244, 164, 96)"],["seagreen","rgb(46, 139, 87)"],["seashell","rgb(255, 245, 238)"],["sienna","rgb(160, 82, 45)"],["skyblue","rgb(135, 206, 235)"],["slateblue","rgb(106, 90, 205)"],["slategray","rgb(112, 128, 144)"],["slategrey","rgb(112, 128, 144)"],["snow","rgb(255, 250, 250)"],["springgreen","rgb(0, 255, 127)"],["steelblue","rgb(70, 130, 180)"],["tan","rgb(210, 180, 140)"],["thistle","rgb(216, 191, 216)"],["tomato","rgb(255, 99, 71)"],["turquoise",
"rgb(64, 224, 208)"],["violet","rgb(238, 130, 238)"],["wheat","rgb(245, 222, 179)"],["whitesmoke","rgb(245, 245, 245)"],["yellowgreen","rgb(154, 205, 50)"],["rebeccapurple","rgb(102, 51, 153)"]],q=function(a){console.error("drs4gb ERROR: "+a)},u=function(a){3<a.length&&(a.length=3);if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))return q("NaN in RGB"),[362,255,255];var c=Math.max.apply(Math,$jscomp.arrayFromIterable(a)),d=Math.min.apply(Math,$jscomp.arrayFromIterable(a)),b=Array(3);a[0]===a[1]&&a[0]===a[2]?
b[0]=361:a[0]>=a[1]&&a[0]>=a[2]?b[0]=60*(a[1]-a[2])/(c-d):a[1]>=a[0]&&a[1]>=a[2]?b[0]=60*(a[2]-a[0])/(c-d)+120:a[2]>=a[0]&&a[2]>=a[1]?b[0]=60*(a[0]-a[1])/(c-d)+240:(q("RGB\u304b\u3089HSV\u3078\u306e\u5909\u63db\u306eH\u306e\u8a08\u7b97\u3067\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c"),b[0]=362);0>b[0]&&(b[0]+=360);b[1]=0===c?0:255*(c-d)/c;b[2]=c;return b},v=function(a){var c=Array(3),d=a[2],b=d-Math.round(a[1]/255*d);360<a[0]?(c[0]=d,c[1]=d,c[2]=d):0<=a[0]&&60>=a[0]?(c[0]=d,c[1]=Math.round(a[0]/60*
(d-b))+b,c[2]=b):60<a[0]&&120>=a[0]?(c[0]=Math.round((120-a[0])/60*(d-b))+b,c[1]=d,c[2]=b):120<a[0]&&180>=a[0]?(c[0]=b,c[1]=d,c[2]=Math.round((a[0]-120)/60*(d-b))+b):180<a[0]&&240>=a[0]?(c[0]=b,c[1]=Math.round((240-a[0])/60*(d-b))+b,c[2]=d):240<a[0]&&300>=a[0]?(c[0]=Math.round((a[0]-240)/60*(d-b))+b,c[1]=b,c[2]=d):300<a[0]&&360>=a[0]?(c[0]=d,c[1]=b,c[2]=Math.round((360-a[0])/60*(d-b))+b):(q("HSV\u304b\u3089RGB\u3078\u306e\u5909\u63db\u3067\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c"),c[0]=c[1]=c[2]=
0);return c},w=function(a){for(var c=Array(3),d=0;3>d;d++)c[d]=parseInt(a[d],10);return c},r=function(a){return a.substring(a.indexOf("(",3)+1,a.length-1).split(", ")},x=function(a,c){var d=r(a);return"rgba("+d[0]+", "+d[1]+", "+d[2]+", "+c+")"},E=function(a){a=r(a);var c=u(w(a));360>=c[0]&&(c[0]-=330,0>c[0]&&(c[0]+=360));c[2]=Math.round(3*c[2]/4);c=v(c);return 4===a.length?"rgba("+c[0]+", "+c[1]+", "+c[2]+", "+a[3]+")":"rgb("+c[0]+", "+c[1]+", "+c[2]+")"},F=function(a){a=r(a);var c=u(w(a));360>=
c[0]&&(c[0]-=345,0>c[0]&&(c[0]+=360));c[2]=Math.round(c[1]*c[2]/255);c[1]+=Math.round((128-c[1])/3);c=v(c);return 4===a.length?"rgba("+c[0]+", "+c[1]+", "+c[2]+", "+a[3]+")":"rgb("+c[0]+", "+c[1]+", "+c[2]+")"},C=function(a){for(var c=a,d=0;d<y.length;d++){var b=y[d][0],e=y[d][1],f=c.indexOf(b);if(-1!==f){for(var k=c.slice(0,f)+e,g=c.indexOf(b,f+b.length);-1!==g;)k+=c.slice(f+b.length,g)+e,f=g,g=c.indexOf(b,f+b.length);c=k+c.slice(f+b.length)}}e=c.indexOf("rgb");d=[];b=[];for(f=0;-1!==e;)if(d.push(e),
b.push(c.indexOf(")",d[f]+11)+1),e=c.indexOf("rgb",b[f]),f++,50<f){q("Infinity Loop on analyze gradient.");break}f=[];for(e=0;e<d.length;e++)f.push(c.substring(d[e],b[e]));e=[];for(k=0;k<f.length;k++){g=r(f[k]);var h=u(w(g));360>=h[0]&&(h[0]-=345,0>h[0]&&(h[0]+=360));h[2]=Math.round(h[1]*h[2]/255);h[1]+=Math.round((128-h[1])/3);h=v(h);4===g.length?e.push("rgba("+h[0]+", "+h[1]+", "+h[2]+", "+g[3]+")"):e.push("rgb("+h[0]+", "+h[1]+", "+h[2]+")")}if(e.length!==d.length||e.length!==b.length)return q("\u914d\u5217\u306e\u9577\u3055\u304c\u9055\u3046"),
a;a="";for(f=0;f<e.length;f++)0===f&&(a=c.substring(0,d[f])),a+=e[f],a=f===e.length-1?a+c.substring(b[f],c.length):a+c.substring(b[f],d[f+1]);return a},z=function(){for(var a=document.getElementsByTagName("*"),c=a.length,d=Array(c),b=0;b<c;b++){var e=a[b].tagName;d[b]=Array(5);for(var f=0;f<d[b].length;f++)d[b][f]=!1;f=window.getComputedStyle(a[b],null);d[b][0]=f.getPropertyValue("color");d[b][1]=f.getPropertyValue("background-color");d[b][2]=f.getPropertyValue("background-image");d[b][3]=f.getPropertyValue("filter");
"IMG"===e&&"rgba(0, 0, 0, 0)"===d[b][1]?d[b][4]=l(a[b]):-1!==d[b][2].indexOf("url(")&&"rgba(0, 0, 0, 0)"===d[b][1]&&"HTML"!==e&&"BODY"!==e&&(d[b][4]=l(a[b]))}for(b=0;b<c;b++)if(e=a[b].tagName,"LINK"!==e&&"META"!==e&&"SCRIPT"!==e&&"NOSCRIPT"!==e&&"STYLE"!==e&&"HEAD"!==e&&"TITLE"!==e&&!a[b].hasAttribute("data-userscript-drs4gb-math"))if("math"===e)a[b].setAttribute("data-userscript-drs4gb-math",""),m(a[b].children);else{f=d[b][0];var k=d[b][1],g=d[b][2],h=d[b][3];if(a[b].hasAttribute("data-userscript-drs4gb-origin-bgcolor")&&
k!==a[b].getAttribute("data-userscript-drs4gb-origin-bgcolor")||"rgba(0, 0, 0, 0)"!==k)a[b].style.setProperty("--userscript-drs4gb-bgcolor",F(k)),a[b].setAttribute("data-userscript-drs4gb-origin-bgcolor",k);if("IMG"===e)a[b].hasAttribute("data-userscript-drs4gb-origin-bgcolor")?(e=k,a[b].hasAttribute("data-userscript-drs4gb-origin-filter-color")&&e===a[b].getAttribute("data-userscript-drs4gb-origin-filter-color")||(a[b].style.setProperty("--userscript-drs4gb-filter-color",x(e,.75)),a[b].setAttribute("data-userscript-drs4gb-origin-filter-color",
e))):(e=d[b][4],a[b].hasAttribute("data-userscript-drs4gb-origin-filter-color")&&e===a[b].getAttribute("data-userscript-drs4gb-origin-filter-color")||(a[b].style.setProperty("--userscript-drs4gb-filter-color",x(e,.75)),a[b].setAttribute("data-userscript-drs4gb-origin-filter-color",e))),a[b].hasAttribute("data-userscript-drs4gb-origin-filters")&&h===a[b].getAttribute("data-userscript-drs4gb-origin-filters")||(a[b].setAttribute("data-userscript-drs4gb-origin-filters",h),"none"===h?a[b].style.setProperty("--userscript-drs4gb-origin-filters",
" "):a[b].style.setProperty("--userscript-drs4gb-origin-filters",h));else{if(-1!==g.indexOf("url(")){if("HTML"===e||"BODY"===e){a[b].hasAttribute("data-userscript-drs4gb-enable-textshadow")||a[b].setAttribute("data-userscript-drs4gb-enable-textshadow","");continue}a[b].hasAttribute("data-userscript-drs4gb-origin-bgcolor")?a[b].hasAttribute("data-userscript-drs4gb-origin-filter-color")&&k===a[b].getAttribute("data-userscript-drs4gb-origin-filter-color")||(a[b].style.setProperty("--userscript-drs4gb-filter-color",
x(k,.75)),a[b].setAttribute("data-userscript-drs4gb-origin-filter-color",k)):(k=d[b][4],a[b].hasAttribute("data-userscript-drs4gb-origin-filter-color")&&k===a[b].getAttribute("data-userscript-drs4gb-origin-filter-color")||(a[b].style.setProperty("--userscript-drs4gb-filter-color",x(k,.75)),a[b].setAttribute("data-userscript-drs4gb-origin-filter-color",k)));a[b].hasAttribute("data-userscript-drs4gb-origin-filters")&&h===a[b].getAttribute("data-userscript-drs4gb-origin-filters")||(a[b].setAttribute("data-userscript-drs4gb-origin-filters",
h),"none"===h?a[b].style.setProperty("--userscript-drs4gb-origin-filters"," "):a[b].style.setProperty("--userscript-drs4gb-origin-filters",h))}a[b].hasAttribute("data-userscript-drs4gb-origin-bgimage")&&g!==a[b].getAttribute("data-userscript-drs4gb-origin-bgimage")?-1!==g.indexOf("-gradient(")?(a[b].style.setProperty("--userscript-drs4gb-bgimage",C(g)),a[b].setAttribute("data-userscript-drs4gb-origin-bgimage",g)):(a[b].removeAttribute("data-userscript-drs4gb-origin-bgimage"),a[b].style.setProperty("--userscript-drs4gb-bgimage",
"")):-1!==g.indexOf("-gradient(")?(a[b].style.setProperty("--userscript-drs4gb-bgimage",C(g)),a[b].setAttribute("data-userscript-drs4gb-origin-bgimage",g)):"none"!==g&&(a[b].hasAttribute("data-userscript-drs4gb-enable-textshadow")||a[b].setAttribute("data-userscript-drs4gb-enable-textshadow",""));if(a[b].hasAttribute("data-userscript-drs4gb-origin-fcolor")&&f!==a[b].getAttribute("data-userscript-drs4gb-origin-fcolor")||"rgba(0, 0, 0, 0)"!==f)h=r(f),g=u(w(h)),360>=g[0]&&(g[0]-=15,0>g[0]&&(g[0]+=360)),
g[1]+=Math.round((16-g[1])/3),g[2]+=Math.round(3*(255-g[2])/4),g=v(g),h=4===h.length?"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+h[3]+")":"rgb("+g[0]+", "+g[1]+", "+g[2]+")",a[b].style.setProperty("--userscript-drs4gb-fcolor",h),a[b].setAttribute("data-userscript-drs4gb-origin-fcolor",f),"A"===e&&(a[b].hasAttribute("data-userscript-drs4gb-enable-fcolor-visited")||a[b].setAttribute("data-userscript-drs4gb-enable-fcolor-visited",""),a[b].style.setProperty("--userscript-drs4gb-fcolor-visited",E(h)))}}};z();
n.appendChild(p);var A=!1,t=!1,D={childList:!0,subtree:!0},B=new MutationObserver(function(a){!1===A?(A=!0,t=!1,setTimeout(function(){B.disconnect();n.removeChild(p);for(z();!0===t;)t=!1,z();n.appendChild(p);B.observe(document,D);A=!1},1E3)):!1===t&&(t=!0)});B.observe(document,D)})();
