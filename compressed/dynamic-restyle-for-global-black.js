// ==UserScript==
// @name Dynamic Restyle Script for Global Black
// @namespace drs4gb
// @author yzrsng
// @description Userscript to change color on website.
// @version 0.20191005.1
// @include http://*
// @include https://*
// @exclude https://www.deviantart.com/*
// @exclude https://twitter.com/*
// @exclude https://mobile.twitter.com/*
// @exclude https://store.steampowered.com/*
// @grant none
// ==/UserScript==

/*
圧縮版。

ウェブページの要素の増減を検知して動的に色を変更する。
パフォーマンスが悪い。
ウェブページの変化を確認する間隔はsetTimeoutで指定。標準は1.0秒。

色はRGBからHSVに変換していじっている。背景色の明るさは鮮やかさに比例するようにした。
画像はそのままだが、その上の文字が色の変更で判別できなくなると困るので黒い縁取り文字にした。
背景色の変化で画像が判別できなくなると困るので後光が指すようにした。
*/

var $jscomp$templatelit$0=["\n:root {\n  background-color: black;\n}\n* {\n  scrollbar-color: #2a2c2e #1c1e1f;\n}\n::-webkit-scrollbar {\n  background-color: #1c1e1f;\n  color: #c5c1b9;\n}\n::-webkit-scrollbar-corner {\n  background-color: #181a1b;\n}\n::-webkit-scrollbar-thumb {\n  background-color: #2a2c2e;\n}\n[","], [","]::placeholder {\n  color: var(",") !important;\n}\n[","]:visited, [","]:visited * {\n  color: var(",") !important;\n}\n[","] {\n  background-color: var(",") !important;\n}\n[",
"] {\n  background-image: var(",") !important;\n}\n[","], [","] * {\n  text-shadow: "," -1px 1px 0px, "," 0px 1px 0px,  "," 1px 1px 0px, "," -1px 0px 0px, "," 1px 0px 0px, "," -1px -1px 0px, "," 0px -1px 0px, "," 1px -1px 0px !important;\n}\n[","] {\n  background-color: rgba(0, 0, 0, 0) !important;\n  filter: var(",") drop-shadow(0px 0px 1px var(",")) !important;\n}"];$jscomp$templatelit$0.raw=$jscomp$templatelit$0.slice();var $jscomp=$jscomp||{};$jscomp.scope={};
$jscomp.arrayIteratorImpl=function(l){var m=0;return function(){return m<l.length?{done:!1,value:l[m++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var m="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return m?m.call(l):$jscomp.arrayIterator(l)};$jscomp.arrayFromIterator=function(l){for(var m,n=[];!(m=l.next()).done;)n.push(m.value);return n};
$jscomp.arrayFromIterable=function(l){return l instanceof Array?l:$jscomp.arrayFromIterator($jscomp.makeIterator(l))};
(function(){function l(a){var b=window.getComputedStyle(a.parentNode).getPropertyValue("background-color");return"rgba(0, 0, 0, 0)"===b?"HTML"===a.parentNode.tagName?"rgb(255, 255, 255)":l(a.parentNode):b}function m(a){for(var b=0;b<a.length;b++)a[b].setAttribute("data-userscript-drs4gb-math",""),m(a[b].children)}var n=document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.id="userscript-drs4gb";p.insertAdjacentHTML("beforeend",String.raw($jscomp$templatelit$0,
"data-userscript-drs4gb-origin-fcolor","data-userscript-drs4gb-origin-fcolor","--userscript-drs4gb-fcolor","data-userscript-drs4gb-enable-fcolor-visited","data-userscript-drs4gb-enable-fcolor-visited","--userscript-drs4gb-fcolor-visited","data-userscript-drs4gb-origin-bgcolor","--userscript-drs4gb-bgcolor","data-userscript-drs4gb-origin-bgimage","--userscript-drs4gb-bgimage","data-userscript-drs4gb-enable-textshadow","data-userscript-drs4gb-enable-textshadow","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)",
"rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","rgba(0, 0, 0, 0.5)","data-userscript-drs4gb-origin-filters","--userscript-drs4gb-exist-filters","--userscript-drs4gb-filter-color"));var y=[["black","rgb(0, 0, 0)"],["silver","rgb(192, 192, 192)"],["gray","rgb(128, 128, 128)"],["white","rgb(255, 255, 255)"],["maroon","rgb(128, 0, 0)"],["red","rgb(255, 0, 0)"],["purple","rgb(128, 0, 128)"],["fuchsia","rgb(255, 0, 255)"],["green","rgb(0, 128, 0)"],
["lime","rgb(0, 255, 0)"],["olive","rgb(128, 128, 0)"],["yellow","rgb(255, 255, 0)"],["navy","rgb(0, 0, 128)"],["blue","rgb(0, 0, 255)"],["teal","rgb(0, 128, 128)"],["aqua","rgb(0, 255, 255)"],["orange","rgb(255, 165, 0)"],["aliceblue","rgb(240, 248, 255)"],["antiquewhite","rgb(250, 235, 215)"],["aquamarine","rgb(127, 255, 212)"],["azure","rgb(240, 255, 255)"],["beige","rgb(245, 245, 220)"],["bisque","rgb(255, 228, 196)"],["blanchedalmond","rgb(255, 235, 205)"],["blueviolet","rgb(138, 43, 226)"],
["brown","rgb(165, 42, 42)"],["burlywood","rgb(222, 184, 135)"],["cadetblue","rgb(95, 158, 160)"],["chartreuse","rgb(127, 255, 0)"],["chocolate","rgb(210, 105, 30)"],["coral","rgb(255, 127, 80)"],["cornflowerblue","rgb(100, 149, 237)"],["cornsilk","rgb(255, 248, 220)"],["crimson","rgb(220, 20, 60)"],["cyan","rgb(0, 255, 255)"],["darkblue","rgb(0, 0, 139)"],["darkcyan","rgb(0, 139, 139)"],["darkgoldenrod","rgb(184, 134, 11)"],["darkgray","rgb(169, 169, 169)"],["darkgreen","rgb(0, 100, 0)"],["darkgrey",
"rgb(169, 169, 169)"],["darkkhaki","rgb(189, 183, 107)"],["darkmagenta","rgb(139, 0, 139)"],["darkolivegreen","rgb(85, 107, 47)"],["darkorange","rgb(255, 140, 0)"],["darkorchid","rgb(153, 50, 204)"],["darkred","rgb(139, 0, 0)"],["darksalmon","rgb(233, 150, 122)"],["darkseagreen","rgb(143, 188, 143)"],["darkslateblue","rgb(72, 61, 139)"],["darkslategray","rgb(47, 79, 79)"],["darkslategrey","rgb(47, 79, 79)"],["darkturquoise","rgb(0, 206, 209)"],["darkviolet","rgb(148, 0, 211)"],["deeppink","rgb(255, 20, 147)"],
["deepskyblue","rgb(0, 191, 255)"],["dimgray","rgb(105, 105, 105)"],["dimgrey","rgb(105, 105, 105)"],["dodgerblue","rgb(30, 144, 255)"],["firebrick","rgb(178, 34, 34)"],["floralwhite","rgb(255, 250, 240)"],["forestgreen","rgb(34, 139, 34)"],["gainsboro","rgb(220, 220, 220)"],["ghostwhite","rgb(248, 248, 255)"],["gold","rgb(255, 215, 0)"],["goldenrod","rgb(218, 165, 32)"],["greenyellow","rgb(173, 255, 47)"],["grey","rgb(128, 128, 128)"],["honeydew","rgb(240, 255, 240)"],["hotpink","rgb(255, 105, 180)"],
["indianred","rgb(205, 92, 92)"],["indigo","rgb(75, 0, 130)"],["ivory","rgb(255, 255, 240)"],["khaki","rgb(240, 230, 140)"],["lavender","rgb(230, 230, 250)"],["lavenderblush","rgb(255, 240, 245)"],["lawngreen","rgb(124, 252, 0)"],["lemonchiffon","rgb(255, 250, 205)"],["lightblue","rgb(173, 216, 230)"],["lightcoral","rgb(240, 128, 128)"],["lightcyan","rgb(224, 255, 255)"],["lightgoldenrodyellow","rgb(250, 250, 210)"],["lightgray","rgb(211, 211, 211)"],["lightgreen","rgb(144, 238, 144)"],["lightgrey",
"rgb(211, 211, 211)"],["lightpink","rgb(255, 182, 193)"],["lightsalmon","rgb(255, 160, 122)"],["lightseagreen","rgb(32, 178, 170)"],["lightskyblue","rgb(135, 206, 250)"],["lightslategray","rgb(119, 136, 153)"],["lightslategrey","rgb(119, 136, 153)"],["lightsteelblue","rgb(176, 196, 222)"],["lightyellow","rgb(255, 255, 224)"],["limegreen","rgb(50, 205, 50)"],["linen","rgb(250, 240, 230)"],["magenta","rgb(255, 0, 255)"],["mediumaquamarine","rgb(102, 205, 170)"],["mediumblue","rgb(0, 0, 205)"],["mediumorchid",
"rgb(186, 85, 211)"],["mediumpurple","rgb(147, 112, 219)"],["mediumseagreen","rgb(60, 179, 113)"],["mediumslateblue","rgb(123, 104, 238)"],["mediumspringgreen","rgb(0, 250, 154)"],["mediumturquoise","rgb(72, 209, 204)"],["mediumvioletred","rgb(199, 21, 133)"],["midnightblue","rgb(25, 25, 112)"],["mintcream","rgb(245, 255, 250)"],["mistyrose","rgb(255, 228, 225)"],["moccasin","rgb(255, 228, 181)"],["navajowhite","rgb(255, 222, 173)"],["oldlace","rgb(253, 245, 230)"],["olivedrab","rgb(107, 142, 35)"],
["orangered","rgb(255, 69, 0)"],["orchid","rgb(218, 112, 214)"],["palegoldenrod","rgb(238, 232, 170)"],["palegreen","rgb(152, 251, 152)"],["paleturquoise","rgb(175, 238, 238)"],["palevioletred","rgb(219, 112, 147)"],["papayawhip","rgb(255, 239, 213)"],["peachpuff","rgb(255, 218, 185)"],["peru","rgb(205, 133, 63)"],["pink","rgb(255, 192, 203)"],["plum","rgb(221, 160, 221)"],["powderblue","rgb(176, 224, 230)"],["rosybrown","rgb(188, 143, 143)"],["royalblue","rgb(65, 105, 225)"],["saddlebrown","rgb(139, 69, 19)"],
["salmon","rgb(250, 128, 114)"],["sandybrown","rgb(244, 164, 96)"],["seagreen","rgb(46, 139, 87)"],["seashell","rgb(255, 245, 238)"],["sienna","rgb(160, 82, 45)"],["skyblue","rgb(135, 206, 235)"],["slateblue","rgb(106, 90, 205)"],["slategray","rgb(112, 128, 144)"],["slategrey","rgb(112, 128, 144)"],["snow","rgb(255, 250, 250)"],["springgreen","rgb(0, 255, 127)"],["steelblue","rgb(70, 130, 180)"],["tan","rgb(210, 180, 140)"],["thistle","rgb(216, 191, 216)"],["tomato","rgb(255, 99, 71)"],["turquoise",
"rgb(64, 224, 208)"],["violet","rgb(238, 130, 238)"],["wheat","rgb(245, 222, 179)"],["whitesmoke","rgb(245, 245, 245)"],["yellowgreen","rgb(154, 205, 50)"],["rebeccapurple","rgb(102, 51, 153)"]],q=function(a){console.error("drs4gb ERROR: "+a)},u=function(a){3<a.length&&(a.length=3);if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))return q("NaN in RGB"),[362,255,255];var b=Math.max.apply(Math,$jscomp.arrayFromIterable(a)),c=Math.min.apply(Math,$jscomp.arrayFromIterable(a)),d=Array(3);a[0]===a[1]&&a[0]===a[2]?
d[0]=361:a[0]>=a[1]&&a[0]>=a[2]?d[0]=60*(a[1]-a[2])/(b-c):a[1]>=a[0]&&a[1]>=a[2]?d[0]=60*(a[2]-a[0])/(b-c)+120:a[2]>=a[0]&&a[2]>=a[1]?d[0]=60*(a[0]-a[1])/(b-c)+240:(q("RGB\u304b\u3089HSV\u3078\u306e\u5909\u63db\u306eH\u306e\u8a08\u7b97\u3067\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c"),d[0]=362);0>d[0]&&(d[0]+=360);d[1]=0===b?0:255*(b-c)/b;d[2]=b;return d},v=function(a){var b=Array(3),c=a[2],d=c-Math.round(a[1]/255*c);360<a[0]?(b[0]=c,b[1]=c,b[2]=c):0<=a[0]&&60>=a[0]?(b[0]=c,b[1]=Math.round(a[0]/60*
(c-d))+d,b[2]=d):60<a[0]&&120>=a[0]?(b[0]=Math.round((120-a[0])/60*(c-d))+d,b[1]=c,b[2]=d):120<a[0]&&180>=a[0]?(b[0]=d,b[1]=c,b[2]=Math.round((a[0]-120)/60*(c-d))+d):180<a[0]&&240>=a[0]?(b[0]=d,b[1]=Math.round((240-a[0])/60*(c-d))+d,b[2]=c):240<a[0]&&300>=a[0]?(b[0]=Math.round((a[0]-240)/60*(c-d))+d,b[1]=d,b[2]=c):300<a[0]&&360>=a[0]?(b[0]=c,b[1]=d,b[2]=Math.round((360-a[0])/60*(c-d))+d):(q("HSV\u304b\u3089RGB\u3078\u306e\u5909\u63db\u3067\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c"),b[0]=b[1]=b[2]=
0);return b},w=function(a){for(var b=Array(3),c=0;3>c;c++)b[c]=parseInt(a[c],10);return b},r=function(a){return a.substring(a.indexOf("(",3)+1,a.length-1).split(", ")},x=function(a,b){var c=r(a);return"rgba("+c[0]+", "+c[1]+", "+c[2]+", "+b+")"},F=function(a){a=r(a);var b=u(w(a));360>=b[0]&&(b[0]-=330,0>b[0]&&(b[0]+=360));b[2]=Math.round(3*b[2]/4);b=v(b);return 4===a.length?"rgba("+b[0]+", "+b[1]+", "+b[2]+", "+a[3]+")":"rgb("+b[0]+", "+b[1]+", "+b[2]+")"},G=function(a){a=r(a);var b=u(w(a));360>=
b[0]&&(b[0]-=345,0>b[0]&&(b[0]+=360));b[2]=Math.round(b[1]*b[2]/255);b[1]+=Math.round((128-b[1])/3);b=v(b);return 4===a.length?"rgba("+b[0]+", "+b[1]+", "+b[2]+", "+a[3]+")":"rgb("+b[0]+", "+b[1]+", "+b[2]+")"},D=function(a){for(var b=a,c=0;c<y.length;c++){var d=y[c][0],f=y[c][1],g=b.indexOf(d);if(-1!==g){for(var h=b.slice(0,g)+f,e=b.indexOf(d,g+d.length);-1!==e;)h+=b.slice(g+d.length,e)+f,g=e,e=b.indexOf(d,g+d.length);b=h+b.slice(g+d.length)}}f=b.indexOf("rgb");c=[];d=[];for(g=0;-1!==f;)if(c.push(f),
d.push(b.indexOf(")",c[g]+11)+1),f=b.indexOf("rgb",d[g]),g++,50<g){q("Infinity Loop on analyze gradient.");break}g=[];for(f=0;f<c.length;f++)g.push(b.substring(c[f],d[f]));f=[];for(h=0;h<g.length;h++){e=r(g[h]);var k=u(w(e));360>=k[0]&&(k[0]-=345,0>k[0]&&(k[0]+=360));k[2]=Math.round(k[1]*k[2]/255);k[1]+=Math.round((128-k[1])/3);k=v(k);4===e.length?f.push("rgba("+k[0]+", "+k[1]+", "+k[2]+", "+e[3]+")"):f.push("rgb("+k[0]+", "+k[1]+", "+k[2]+")")}if(f.length!==c.length||f.length!==d.length)return q("\u914d\u5217\u306e\u9577\u3055\u304c\u9055\u3046"),
a;a="";for(g=0;g<f.length;g++)0===g&&(a=b.substring(0,c[g])),a+=f[g],a=g===f.length-1?a+b.substring(d[g],b.length):a+b.substring(d[g],c[g+1]);return a},z=function(a){for(var b=a.length,c=0;c<b;c++){var d=a[c].tagName;if("LINK"!==d&&"META"!==d&&"SCRIPT"!==d&&"NOSCRIPT"!==d&&"STYLE"!==d&&"HEAD"!==d&&"TITLE"!==d&&!a[c].hasAttribute("data-userscript-drs4gb-math"))if("math"===d)a[c].setAttribute("data-userscript-drs4gb-math",""),m(a[c].children);else{var f=window.getComputedStyle(a[c],null),g=f.getPropertyValue("color"),
h=f.getPropertyValue("background-color"),e=f.getPropertyValue("background-image");f=f.getPropertyValue("filter");if(a[c].hasAttribute("data-userscript-drs4gb-origin-bgcolor")&&h!==a[c].getAttribute("data-userscript-drs4gb-origin-bgcolor")||"rgba(0, 0, 0, 0)"!==h)a[c].style.setProperty("--userscript-drs4gb-bgcolor",G(h)),a[c].setAttribute("data-userscript-drs4gb-origin-bgcolor",h);if("IMG"===d)a[c].hasAttribute("data-userscript-drs4gb-origin-bgcolor")?a[c].style.setProperty("--userscript-drs4gb-filter-color",
x(h,.75)):a[c].style.setProperty("--userscript-drs4gb-filter-color",x(l(a[c]),.75)),a[c].hasAttribute("data-userscript-drs4gb-origin-filters")?f!==a[c].getAttribute("data-userscript-drs4gb-origin-filters")&&a[c].setAttribute("data-userscript-drs4gb-origin-filters",f):a[c].setAttribute("data-userscript-drs4gb-origin-filters",f),"none"===f?a[c].style.setProperty("--userscript-drs4gb-exist-filters"," "):a[c].style.setProperty("--userscript-drs4gb-exist-filters",f);else{if(-1!==e.indexOf("url(")){if("HTML"===
d||"BODY"===d){a[c].hasAttribute("data-userscript-drs4gb-enable-textshadow")||a[c].setAttribute("data-userscript-drs4gb-enable-textshadow","");continue}a[c].hasAttribute("data-userscript-drs4gb-origin-bgcolor")?a[c].style.setProperty("--userscript-drs4gb-filter-color",x(h,.75)):a[c].style.setProperty("--userscript-drs4gb-filter-color",x(l(a[c]),.75));a[c].hasAttribute("data-userscript-drs4gb-origin-filters")?f!==a[c].getAttribute("data-userscript-drs4gb-origin-filters")&&a[c].setAttribute("data-userscript-drs4gb-origin-filters",
f):a[c].setAttribute("data-userscript-drs4gb-origin-filters",f);"none"===f?a[c].style.setProperty("--userscript-drs4gb-exist-filters"," "):a[c].style.setProperty("--userscript-drs4gb-exist-filters",f)}a[c].hasAttribute("data-userscript-drs4gb-origin-bgimage")&&e!==a[c].getAttribute("data-userscript-drs4gb-origin-bgimage")?-1!==e.indexOf("-gradient(")?(a[c].style.setProperty("--userscript-drs4gb-bgimage",D(e)),a[c].setAttribute("data-userscript-drs4gb-origin-bgimage",e)):(a[c].removeAttribute("data-userscript-drs4gb-origin-bgimage"),
a[c].style.setProperty("--userscript-drs4gb-bgimage","")):-1!==e.indexOf("-gradient(")?(a[c].style.setProperty("--userscript-drs4gb-bgimage",D(e)),a[c].setAttribute("data-userscript-drs4gb-origin-bgimage",e)):"none"!==e&&(a[c].hasAttribute("data-userscript-drs4gb-enable-textshadow")||a[c].setAttribute("data-userscript-drs4gb-enable-textshadow",""));if(a[c].hasAttribute("data-userscript-drs4gb-origin-fcolor")&&g!==a[c].getAttribute("data-userscript-drs4gb-origin-fcolor")||"rgba(0, 0, 0, 0)"!==g)h=
r(g),e=u(w(h)),360>=e[0]&&(e[0]-=15,0>e[0]&&(e[0]+=360)),e[1]+=Math.round((16-e[1])/3),e[2]+=Math.round(3*(255-e[2])/4),e=v(e),h=4===h.length?"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+h[3]+")":"rgb("+e[0]+", "+e[1]+", "+e[2]+")",a[c].style.setProperty("--userscript-drs4gb-fcolor",h),a[c].setAttribute("data-userscript-drs4gb-origin-fcolor",g),"A"===d&&(a[c].hasAttribute("data-userscript-drs4gb-enable-fcolor-visited")||a[c].setAttribute("data-userscript-drs4gb-enable-fcolor-visited",""),a[c].style.setProperty("--userscript-drs4gb-fcolor-visited",
F(h)))}}}},A=document.getElementsByTagName("*");z(A);n.appendChild(p);var B=!1,t=!1,E={childList:!0,subtree:!0},C=new MutationObserver(function(a){!1===B?(B=!0,t=!1,setTimeout(function(){C.disconnect();n.removeChild(p);for(z(A);!0===t;)t=!1,z(A);n.appendChild(p);C.observe(document,E);B=!1},1E3)):!1===t&&(t=!0)});C.observe(document,E)})();
